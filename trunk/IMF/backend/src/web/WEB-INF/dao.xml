<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans 
       http://www.springframework.org/schema/beans/spring-beans.xsd">

    <bean id="longType" class="org.hibernate.type.LongType"/>
    <bean id="stringType" class="org.hibernate.type.StringType"/>
    <bean id="integerType" class="org.hibernate.type.IntegerType"/>
    <bean id="booleanType" class="org.hibernate.type.BooleanType"/>


    <bean id="sqlScalarTypesConfig" class="imf.core.config.SqlScalarTypesConfig">
        <property name="scalarMap">
            <map>
                <entry key="ScalarTypes4TemplatesDto">
                    <map>
                        <entry key="templateId" value-ref="longType"/>
                        <entry key="templateName" value-ref="stringType"/>
                        <entry key="groupId" value-ref="longType"/>
                        <entry key="groupName" value-ref="stringType"/>
                        <entry key="attributeId" value-ref="longType"/>
                        <entry key="attributeName" value-ref="stringType"/>
                        <entry key="attributeWeight" value-ref="integerType"/>
                        <entry key="groupWeight" value-ref="integerType"/>
                        <entry key="attributeRequire" value-ref="booleanType"/>
                        <entry key="attributeComposite" value-ref="booleanType"/>
                    </map>
                </entry>
            </map>
        </property>
        <property name="sqlMap">
            <map>
                <entry key="sql4TemplatesDto">
                    <value>
                        select
                        tpl.id as "templateId",
                        tpl."name" as "templateName",
                        grp.id as "groupId",
                        grp."name" as "groupName",
                        atr.id as "attributeId",
                        atr."name" as "attributeName",
                        g2t.weight as "attributeWeight",
                        a2g.weight as "groupWeight",
                        a2g2t.required as "attributeRequire",
                        a2g2t.composite as "attributeComposite"
                        from
                        imf.attribute atr
                        inner join
                        imf.attribute_2_group a2g
                        on a2g.attribute_id = atr.id
                        inner join
                        imf."group" grp
                        on grp.id = a2g.group_id
                        inner join
                        imf.group_2_template g2t
                        on g2t.group_id = grp.id
                        inner join
                        imf."template" tpl
                        on tpl.id = g2t.template_id
                        inner join
                        imf.attribute_2_group_2_template a2g2t
                        on a2g2t.attribute_id = atr.id
                        and a2g2t.group_id = grp.id
                        and a2g2t.template_id = tpl.id
                        where
                        tpl.id = :templateId
                        order by
                        g2t.weight,
                        a2g.weight
                    </value>
                </entry>
            </map>
        </property>
    </bean>

</beans>